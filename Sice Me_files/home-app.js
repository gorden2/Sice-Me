!function(){var e=this,t=e._,n={},i=Array.prototype,r=Object.prototype,s=Function.prototype,o=i.push,a=i.slice,l=i.concat,u=r.toString,c=r.hasOwnProperty,d=i.forEach,h=i.map,f=i.reduce,p=i.reduceRight,m=i.filter,g=i.every,v=i.some,y=i.indexOf,_=i.lastIndexOf,b=Array.isArray,w=Object.keys,k=s.bind,M=function(e){return e instanceof M?e:this instanceof M?(this._wrapped=e,void 0):new M(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=M),exports._=M):e._=M,M.VERSION="1.4.4";var C=M.each=M.forEach=function(e,t,i){if(null!=e)if(d&&e.forEach===d)e.forEach(t,i);else if(e.length===+e.length){for(var r=0,s=e.length;s>r;r++)if(t.call(i,e[r],r,e)===n)return}else for(var o in e)if(M.has(e,o)&&t.call(i,e[o],o,e)===n)return};M.map=M.collect=function(e,t,n){var i=[];return null==e?i:h&&e.map===h?e.map(t,n):(C(e,function(e,r,s){i[i.length]=t.call(n,e,r,s)}),i)};var R="Reduce of empty array with no initial value";M.reduce=M.foldl=M.inject=function(e,t,n,i){var r=arguments.length>2;if(null==e&&(e=[]),f&&e.reduce===f)return i&&(t=M.bind(t,i)),r?e.reduce(t,n):e.reduce(t);if(C(e,function(e,s,o){r?n=t.call(i,n,e,s,o):(n=e,r=!0)}),!r)throw new TypeError(R);return n},M.reduceRight=M.foldr=function(e,t,n,i){var r=arguments.length>2;if(null==e&&(e=[]),p&&e.reduceRight===p)return i&&(t=M.bind(t,i)),r?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=M.keys(e);s=o.length}if(C(e,function(a,l,u){l=o?o[--s]:--s,r?n=t.call(i,n,e[l],l,u):(n=e[l],r=!0)}),!r)throw new TypeError(R);return n},M.find=M.detect=function(e,t,n){var i;return x(e,function(e,r,s){return t.call(n,e,r,s)?(i=e,!0):void 0}),i},M.filter=M.select=function(e,t,n){var i=[];return null==e?i:m&&e.filter===m?e.filter(t,n):(C(e,function(e,r,s){t.call(n,e,r,s)&&(i[i.length]=e)}),i)},M.reject=function(e,t,n){return M.filter(e,function(e,i,r){return!t.call(n,e,i,r)},n)},M.every=M.all=function(e,t,i){t||(t=M.identity);var r=!0;return null==e?r:g&&e.every===g?e.every(t,i):(C(e,function(e,s,o){return(r=r&&t.call(i,e,s,o))?void 0:n}),!!r)};var x=M.some=M.any=function(e,t,i){t||(t=M.identity);var r=!1;return null==e?r:v&&e.some===v?e.some(t,i):(C(e,function(e,s,o){return r||(r=t.call(i,e,s,o))?n:void 0}),!!r)};M.contains=M.include=function(e,t){return null==e?!1:y&&e.indexOf===y?-1!=e.indexOf(t):x(e,function(e){return e===t})},M.invoke=function(e,t){var n=a.call(arguments,2),i=M.isFunction(t);return M.map(e,function(e){return(i?t:e[t]).apply(e,n)})},M.pluck=function(e,t){return M.map(e,function(e){return e[t]})},M.where=function(e,t,n){return M.isEmpty(t)?n?null:[]:M[n?"find":"filter"](e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},M.findWhere=function(e,t){return M.where(e,t,!0)},M.max=function(e,t,n){if(!t&&M.isArray(e)&&e[0]===+e[0]&&65535>e.length)return Math.max.apply(Math,e);if(!t&&M.isEmpty(e))return-1/0;var i={computed:-1/0,value:-1/0};return C(e,function(e,r,s){var o=t?t.call(n,e,r,s):e;o>=i.computed&&(i={value:e,computed:o})}),i.value},M.min=function(e,t,n){if(!t&&M.isArray(e)&&e[0]===+e[0]&&65535>e.length)return Math.min.apply(Math,e);if(!t&&M.isEmpty(e))return 1/0;var i={computed:1/0,value:1/0};return C(e,function(e,r,s){var o=t?t.call(n,e,r,s):e;i.computed>o&&(i={value:e,computed:o})}),i.value},M.shuffle=function(e){var t,n=0,i=[];return C(e,function(e){t=M.random(n++),i[n-1]=i[t],i[t]=e}),i};var F=function(e){return M.isFunction(e)?e:function(t){return t[e]}};M.sortBy=function(e,t,n){var i=F(t);return M.pluck(M.map(e,function(e,t,r){return{value:e,index:t,criteria:i.call(n,e,t,r)}}).sort(function(e,t){var n=e.criteria,i=t.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(i>n||void 0===i)return-1}return e.index<t.index?-1:1}),"value")};var A=function(e,t,n,i){var r={},s=F(t||M.identity);return C(e,function(t,o){var a=s.call(n,t,o,e);i(r,a,t)}),r};M.groupBy=function(e,t,n){return A(e,t,n,function(e,t,n){(M.has(e,t)?e[t]:e[t]=[]).push(n)})},M.countBy=function(e,t,n){return A(e,t,n,function(e,t){M.has(e,t)||(e[t]=0),e[t]++})},M.sortedIndex=function(e,t,n,i){n=null==n?M.identity:F(n);for(var r=n.call(i,t),s=0,o=e.length;o>s;){var a=s+o>>>1;r>n.call(i,e[a])?s=a+1:o=a}return s},M.toArray=function(e){return e?M.isArray(e)?a.call(e):e.length===+e.length?M.map(e,M.identity):M.values(e):[]},M.size=function(e){return null==e?0:e.length===+e.length?e.length:M.keys(e).length},M.first=M.head=M.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:a.call(e,0,t)},M.initial=function(e,t,n){return a.call(e,0,e.length-(null==t||n?1:t))},M.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:a.call(e,Math.max(e.length-t,0))},M.rest=M.tail=M.drop=function(e,t,n){return a.call(e,null==t||n?1:t)},M.compact=function(e){return M.filter(e,M.identity)};var T=function(e,t,n){return C(e,function(e){M.isArray(e)?t?o.apply(n,e):T(e,t,n):n.push(e)}),n};M.flatten=function(e,t){return T(e,t,[])},M.without=function(e){return M.difference(e,a.call(arguments,1))},M.uniq=M.unique=function(e,t,n,i){M.isFunction(t)&&(i=n,n=t,t=!1);var r=n?M.map(e,n,i):e,s=[],o=[];return C(r,function(n,i){(t?i&&o[o.length-1]===n:M.contains(o,n))||(o.push(n),s.push(e[i]))}),s},M.union=function(){return M.uniq(l.apply(i,arguments))},M.intersection=function(e){var t=a.call(arguments,1);return M.filter(M.uniq(e),function(e){return M.every(t,function(t){return M.indexOf(t,e)>=0})})},M.difference=function(e){var t=l.apply(i,a.call(arguments,1));return M.filter(e,function(e){return!M.contains(t,e)})},M.zip=function(){for(var e=a.call(arguments),t=M.max(M.pluck(e,"length")),n=Array(t),i=0;t>i;i++)n[i]=M.pluck(e,""+i);return n},M.object=function(e,t){if(null==e)return{};for(var n={},i=0,r=e.length;r>i;i++)t?n[e[i]]=t[i]:n[e[i][0]]=e[i][1];return n},M.indexOf=function(e,t,n){if(null==e)return-1;var i=0,r=e.length;if(n){if("number"!=typeof n)return i=M.sortedIndex(e,t),e[i]===t?i:-1;i=0>n?Math.max(0,r+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;r>i;i++)if(e[i]===t)return i;return-1},M.lastIndexOf=function(e,t,n){if(null==e)return-1;var i=null!=n;if(_&&e.lastIndexOf===_)return i?e.lastIndexOf(t,n):e.lastIndexOf(t);for(var r=i?n:e.length;r--;)if(e[r]===t)return r;return-1},M.range=function(e,t,n){1>=arguments.length&&(t=e||0,e=0),n=arguments[2]||1;for(var i=Math.max(Math.ceil((t-e)/n),0),r=0,s=Array(i);i>r;)s[r++]=e,e+=n;return s},M.bind=function(e,t){if(e.bind===k&&k)return k.apply(e,a.call(arguments,1));var n=a.call(arguments,2);return function(){return e.apply(t,n.concat(a.call(arguments)))}},M.partial=function(e){var t=a.call(arguments,1);return function(){return e.apply(this,t.concat(a.call(arguments)))}},M.bindAll=function(e){var t=a.call(arguments,1);return 0===t.length&&(t=M.functions(e)),C(t,function(t){e[t]=M.bind(e[t],e)}),e},M.memoize=function(e,t){var n={};return t||(t=M.identity),function(){var i=t.apply(this,arguments);return M.has(n,i)?n[i]:n[i]=e.apply(this,arguments)}},M.delay=function(e,t){var n=a.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},M.defer=function(e){return M.delay.apply(M,[e,1].concat(a.call(arguments,1)))},M.throttle=function(e,t){var n,i,r,s,o=0,a=function(){o=new Date,r=null,s=e.apply(n,i)};return function(){var l=new Date,u=t-(l-o);return n=this,i=arguments,0>=u?(clearTimeout(r),r=null,o=l,s=e.apply(n,i)):r||(r=setTimeout(a,u)),s}},M.debounce=function(e,t,n){var i,r;return function(){var s=this,o=arguments,a=function(){i=null,n||(r=e.apply(s,o))},l=n&&!i;return clearTimeout(i),i=setTimeout(a,t),l&&(r=e.apply(s,o)),r}},M.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}},M.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n)}},M.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},M.after=function(e,t){return 0>=e?t():function(){return 1>--e?t.apply(this,arguments):void 0}},M.keys=w||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)M.has(e,n)&&(t[t.length]=n);return t},M.values=function(e){var t=[];for(var n in e)M.has(e,n)&&t.push(e[n]);return t},M.pairs=function(e){var t=[];for(var n in e)M.has(e,n)&&t.push([n,e[n]]);return t},M.invert=function(e){var t={};for(var n in e)M.has(e,n)&&(t[e[n]]=n);return t},M.functions=M.methods=function(e){var t=[];for(var n in e)M.isFunction(e[n])&&t.push(n);return t.sort()},M.extend=function(e){return C(a.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},M.pick=function(e){var t={},n=l.apply(i,a.call(arguments,1));return C(n,function(n){n in e&&(t[n]=e[n])}),t},M.omit=function(e){var t={},n=l.apply(i,a.call(arguments,1));for(var r in e)M.contains(n,r)||(t[r]=e[r]);return t},M.defaults=function(e){return C(a.call(arguments,1),function(t){if(t)for(var n in t)null==e[n]&&(e[n]=t[n])}),e},M.clone=function(e){return M.isObject(e)?M.isArray(e)?e.slice():M.extend({},e):e},M.tap=function(e,t){return t(e),e};var S=function(e,t,n,i){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof M&&(e=e._wrapped),t instanceof M&&(t=t._wrapped);var r=u.call(e);if(r!=u.call(t))return!1;switch(r){case"[object String]":return e==t+"";case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var s=n.length;s--;)if(n[s]==e)return i[s]==t;n.push(e),i.push(t);var o=0,a=!0;if("[object Array]"==r){if(o=e.length,a=o==t.length)for(;o--&&(a=S(e[o],t[o],n,i)););}else{var l=e.constructor,c=t.constructor;if(l!==c&&!(M.isFunction(l)&&l instanceof l&&M.isFunction(c)&&c instanceof c))return!1;for(var d in e)if(M.has(e,d)&&(o++,!(a=M.has(t,d)&&S(e[d],t[d],n,i))))break;if(a){for(d in t)if(M.has(t,d)&&!o--)break;a=!o}}return n.pop(),i.pop(),a};M.isEqual=function(e,t){return S(e,t,[],[])},M.isEmpty=function(e){if(null==e)return!0;if(M.isArray(e)||M.isString(e))return 0===e.length;for(var t in e)if(M.has(e,t))return!1;return!0},M.isElement=function(e){return!(!e||1!==e.nodeType)},M.isArray=b||function(e){return"[object Array]"==u.call(e)},M.isObject=function(e){return e===Object(e)},C(["Arguments","Function","String","Number","Date","RegExp"],function(e){M["is"+e]=function(t){return u.call(t)=="[object "+e+"]"}}),M.isArguments(arguments)||(M.isArguments=function(e){return!(!e||!M.has(e,"callee"))}),"function"!=typeof/./&&(M.isFunction=function(e){return"function"==typeof e}),M.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},M.isNaN=function(e){return M.isNumber(e)&&e!=+e},M.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==u.call(e)},M.isNull=function(e){return null===e},M.isUndefined=function(e){return void 0===e},M.has=function(e,t){return c.call(e,t)},M.noConflict=function(){return e._=t,this},M.identity=function(e){return e},M.times=function(e,t,n){for(var i=Array(e),r=0;e>r;r++)i[r]=t.call(n,r);return i},M.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var O={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};O.unescape=M.invert(O.escape);var I={escape:RegExp("["+M.keys(O.escape).join("")+"]","g"),unescape:RegExp("("+M.keys(O.unescape).join("|")+")","g")};M.each(["escape","unescape"],function(e){M[e]=function(t){return null==t?"":(""+t).replace(I[e],function(t){return O[e][t]})}}),M.result=function(e,t){if(null==e)return null;var n=e[t];return M.isFunction(n)?n.call(e):n},M.mixin=function(e){C(M.functions(e),function(t){var n=M[t]=e[t];M.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),P.call(this,n.apply(M,e))}})};var E=0;M.uniqueId=function(e){var t=++E+"";return e?e+t:t},M.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var $=/(.)^/,D={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},j=/\\|'|\r|\n|\t|\u2028|\u2029/g;M.template=function(e,t,n){var i;n=M.defaults({},n,M.templateSettings);var r=RegExp([(n.escape||$).source,(n.interpolate||$).source,(n.evaluate||$).source].join("|")+"|$","g"),s=0,o="__p+='";e.replace(r,function(t,n,i,r,a){return o+=e.slice(s,a).replace(j,function(e){return"\\"+D[e]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),i&&(o+="'+\n((__t=("+i+"))==null?'':__t)+\n'"),r&&(o+="';\n"+r+"\n__p+='"),s=a+t.length,t}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{i=Function(n.variable||"obj","_",o)}catch(a){throw a.source=o,a}if(t)return i(t,M);var l=function(e){return i.call(this,e,M)};return l.source="function("+(n.variable||"obj")+"){\n"+o+"}",l},M.chain=function(e){return M(e).chain()};var P=function(e){return this._chain?M(e).chain():e};M.mixin(M),C(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=i[e];M.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!=e&&"splice"!=e||0!==n.length||delete n[0],P.call(this,n)}}),C(["concat","join","slice"],function(e){var t=i[e];M.prototype[e]=function(){return P.call(this,t.apply(this._wrapped,arguments))}}),M.extend(M.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),define("underscore",function(e){return function(){var t;return t||e._}}(this)),function(){var e=this,t=e.Backbone,n=[];n.push;var i=n.slice;n.splice;var r;r="undefined"!=typeof exports?exports:e.Backbone={},r.VERSION="1.1.0";var s=e._;s||"undefined"==typeof require||(s=require("underscore")),r.$=e.jQuery||e.Zepto||e.ender||e.$,r.noConflict=function(){return e.Backbone=t,this},r.emulateHTTP=!1,r.emulateJSON=!1;var o=r.Events={on:function(e,t,n){if(!l(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var i=this._events[e]||(this._events[e]=[]);return i.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,n){if(!l(this,"once",e,[t,n])||!t)return this;var i=this,r=s.once(function(){i.off(e,r),t.apply(this,arguments)});return r._callback=t,this.on(e,r,n)},off:function(e,t,n){var i,r,o,a,u,c,d,h;if(!this._events||!l(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._events={},this;for(a=e?[e]:s.keys(this._events),u=0,c=a.length;c>u;u++)if(e=a[u],o=this._events[e]){if(this._events[e]=i=[],t||n)for(d=0,h=o.length;h>d;d++)r=o[d],(t&&t!==r.callback&&t!==r.callback._callback||n&&n!==r.context)&&i.push(r);i.length||delete this._events[e]}return this},trigger:function(e){if(!this._events)return this;var t=i.call(arguments,1);if(!l(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&u(n,t),r&&u(r,arguments),this},stopListening:function(e,t,n){var i=this._listeningTo;if(!i)return this;var r=!t&&!n;n||"object"!=typeof t||(n=this),e&&((i={})[e._listenId]=e);for(var o in i)e=i[o],e.off(t,n,this),(r||s.isEmpty(e._events))&&delete this._listeningTo[o];return this}},a=/\s+/,l=function(e,t,n,i){if(!n)return!0;if("object"==typeof n){for(var r in n)e[t].apply(e,[r,n[r]].concat(i));return!1}if(a.test(n)){for(var s=n.split(a),o=0,l=s.length;l>o;o++)e[t].apply(e,[s[o]].concat(i));return!1}return!0},u=function(e,t){var n,i=-1,r=e.length,s=t[0],o=t[1],a=t[2];switch(t.length){case 0:for(;++i<r;)(n=e[i]).callback.call(n.ctx);return;case 1:for(;++i<r;)(n=e[i]).callback.call(n.ctx,s);return;case 2:for(;++i<r;)(n=e[i]).callback.call(n.ctx,s,o);return;case 3:for(;++i<r;)(n=e[i]).callback.call(n.ctx,s,o,a);return;default:for(;++i<r;)(n=e[i]).callback.apply(n.ctx,t)}},c={listenTo:"on",listenToOnce:"once"};s.each(c,function(e,t){o[t]=function(t,n,i){var r=this._listeningTo||(this._listeningTo={}),o=t._listenId||(t._listenId=s.uniqueId("l"));return r[o]=t,i||"object"!=typeof n||(i=this),t[e](n,i,this),this}}),o.bind=o.on,o.unbind=o.off,s.extend(r,o);var d=r.Model=function(e,t){var n=e||{};t||(t={}),this.cid=s.uniqueId("c"),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(n=this.parse(n,t)||{}),n=s.defaults({},n,s.result(this,"defaults")),this.set(n,t),this.changed={},this.initialize.apply(this,arguments)};s.extend(d.prototype,o,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return s.clone(this.attributes)},sync:function(){return r.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return s.escape(this.get(e))},has:function(e){return null!=this.get(e)},set:function(e,t,n){var i,r,o,a,l,u,c,d;if(null==e)return this;if("object"==typeof e?(r=e,n=t):(r={})[e]=t,n||(n={}),!this._validate(r,n))return!1;o=n.unset,l=n.silent,a=[],u=this._changing,this._changing=!0,u||(this._previousAttributes=s.clone(this.attributes),this.changed={}),d=this.attributes,c=this._previousAttributes,this.idAttribute in r&&(this.id=r[this.idAttribute]);for(i in r)t=r[i],s.isEqual(d[i],t)||a.push(i),s.isEqual(c[i],t)?delete this.changed[i]:this.changed[i]=t,o?delete d[i]:d[i]=t;if(!l){a.length&&(this._pending=!0);for(var h=0,f=a.length;f>h;h++)this.trigger("change:"+a[h],this,d[a[h]],n)}if(u)return this;if(!l)for(;this._pending;)this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,s.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,s.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!s.isEmpty(this.changed):s.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?s.clone(this.changed):!1;var t,n=!1,i=this._changing?this._previousAttributes:this.attributes;for(var r in e)s.isEqual(i[r],t=e[r])||((n||(n={}))[r]=t);return n},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return s.clone(this._previousAttributes)},fetch:function(e){e=e?s.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=this,n=e.success;return e.success=function(i){return t.set(t.parse(i,e),e)?(n&&n(t,i,e),t.trigger("sync",t,i,e),void 0):!1},j(this,e),this.sync("read",this,e)},save:function(e,t,n){var i,r,o,a=this.attributes;if(null==e||"object"==typeof e?(i=e,n=t):(i={})[e]=t,n=s.extend({validate:!0},n),i&&!n.wait){if(!this.set(i,n))return!1}else if(!this._validate(i,n))return!1;i&&n.wait&&(this.attributes=s.extend({},a,i)),void 0===n.parse&&(n.parse=!0);var l=this,u=n.success;return n.success=function(e){l.attributes=a;var t=l.parse(e,n);return n.wait&&(t=s.extend(i||{},t)),s.isObject(t)&&!l.set(t,n)?!1:(u&&u(l,e,n),l.trigger("sync",l,e,n),void 0)},j(this,n),r=this.isNew()?"create":n.patch?"patch":"update","patch"===r&&(n.attrs=i),o=this.sync(r,this,n),i&&n.wait&&(this.attributes=a),o},destroy:function(e){e=e?s.clone(e):{};var t=this,n=e.success,i=function(){t.trigger("destroy",t,t.collection,e)};if(e.success=function(r){(e.wait||t.isNew())&&i(),n&&n(t,r,e),t.isNew()||t.trigger("sync",t,r,e)},this.isNew())return e.success(),!1;j(this,e);var r=this.sync("delete",this,e);return e.wait||i(),r},url:function(){var e=s.result(this,"urlRoot")||s.result(this.collection,"url")||D();return this.isNew()?e:e+("/"===e.charAt(e.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(e){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(e){return this._validate({},s.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=s.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return n?(this.trigger("invalid",this,n,s.extend(t,{validationError:n})),!1):!0}});var h=["keys","values","pairs","invert","pick","omit"];s.each(h,function(e){d.prototype[e]=function(){var t=i.call(arguments);return t.unshift(this.attributes),s[e].apply(s,t)}});var f=r.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,s.extend({silent:!0},t))},p={add:!0,remove:!0,merge:!0},m={add:!0,remove:!1};s.extend(f.prototype,o,{model:d,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return r.sync.apply(this,arguments)},add:function(e,t){return this.set(e,s.extend({merge:!1},t,m))},remove:function(e,t){var n=!s.isArray(e);e=n?[e]:s.clone(e),t||(t={});var i,r,o,a;for(i=0,r=e.length;r>i;i++)a=e[i]=this.get(e[i]),a&&(delete this._byId[a.id],delete this._byId[a.cid],o=this.indexOf(a),this.models.splice(o,1),this.length--,t.silent||(t.index=o,a.trigger("remove",a,this,t)),this._removeReference(a));return n?e[0]:e},set:function(e,t){t=s.defaults({},t,p),t.parse&&(e=this.parse(e,t));var n=!s.isArray(e);e=n?e?[e]:[]:s.clone(e);var i,r,o,a,l,u,c,h=t.at,f=this.model,m=this.comparator&&null==h&&t.sort!==!1,g=s.isString(this.comparator)?this.comparator:null,v=[],y=[],_={},b=t.add,w=t.merge,k=t.remove,M=!m&&b&&k?[]:!1;for(i=0,r=e.length;r>i;i++){if(l=e[i],o=l instanceof d?a=l:l[f.prototype.idAttribute],u=this.get(o))k&&(_[u.cid]=!0),w&&(l=l===a?a.attributes:l,t.parse&&(l=u.parse(l,t)),u.set(l,t),m&&!c&&u.hasChanged(g)&&(c=!0)),e[i]=u;else if(b){if(a=e[i]=this._prepareModel(l,t),!a)continue;v.push(a),a.on("all",this._onModelEvent,this),this._byId[a.cid]=a,null!=a.id&&(this._byId[a.id]=a)}M&&M.push(u||a)}if(k){for(i=0,r=this.length;r>i;++i)_[(a=this.models[i]).cid]||y.push(a);y.length&&this.remove(y,t)}if(v.length||M&&M.length)if(m&&(c=!0),this.length+=v.length,null!=h)for(i=0,r=v.length;r>i;i++)this.models.splice(h+i,0,v[i]);else{M&&(this.models.length=0);var C=M||v;for(i=0,r=C.length;r>i;i++)this.models.push(C[i])}if(c&&this.sort({silent:!0}),!t.silent){for(i=0,r=v.length;r>i;i++)(a=v[i]).trigger("add",a,this,t);(c||M&&M.length)&&this.trigger("sort",this,t)}return n?e[0]:e},reset:function(e,t){t||(t={});for(var n=0,i=this.models.length;i>n;n++)this._removeReference(this.models[n]);return t.previousModels=this.models,this._reset(),e=this.add(e,s.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,s.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return this.add(e,s.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(){return i.apply(this.models,arguments)},get:function(e){return null==e?void 0:this._byId[e.id]||this._byId[e.cid]||this._byId[e]},at:function(e){return this.models[e]},where:function(e,t){return s.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),s.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(s.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return s.invoke(this.models,"get",e)},fetch:function(e){e=e?s.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=e.success,n=this;return e.success=function(i){var r=e.reset?"reset":"set";n[r](i,e),t&&t(n,i,e),n.trigger("sync",n,i,e)},j(this,e),this.sync("read",this,e)},create:function(e,t){if(t=t?s.clone(t):{},!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var n=this,i=t.success;return t.success=function(e,t,r){r.wait&&n.add(e,r),i&&i(e,t,r)},e.save(null,t),e},parse:function(e){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof d)return e.collection||(e.collection=this),e;t=t?s.clone(t):{},t.collection=this;var n=new this.model(e,t);return n.validationError?(this.trigger("invalid",this,n.validationError,t),!1):n},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,i){("add"!==e&&"remove"!==e||n===this)&&("destroy"===e&&this.remove(t,i),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],null!=t.id&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments))}});var g=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain"];s.each(g,function(e){f.prototype[e]=function(){var t=i.call(arguments);return t.unshift(this.models),s[e].apply(s,t)}});var v=["groupBy","countBy","sortBy"];s.each(v,function(e){f.prototype[e]=function(t,n){var i=s.isFunction(t)?t:function(e){return e.get(t)};return s[e](this.models,i,n)}});var y=r.View=function(e){this.cid=s.uniqueId("view"),e||(e={}),s.extend(this,s.pick(e,b)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},_=/^(\S+)\s*(.*)$/,b=["model","collection","el","id","attributes","className","tagName","events"];s.extend(y.prototype,o,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,t){return this.$el&&this.undelegateEvents(),this.$el=e instanceof r.$?e:r.$(e),this.el=this.$el[0],t!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=s.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var n=e[t];if(s.isFunction(n)||(n=this[e[t]]),n){var i=t.match(_),r=i[1],o=i[2];n=s.bind(n,this),r+=".delegateEvents"+this.cid,""===o?this.$el.on(r,n):this.$el.on(r,o,n)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(s.result(this,"el"),!1);else{var e=s.extend({},s.result(this,"attributes"));this.id&&(e.id=s.result(this,"id")),this.className&&(e["class"]=s.result(this,"className"));var t=r.$("<"+s.result(this,"tagName")+">").attr(e);this.setElement(t,!1)}}}),r.sync=function(e,t,n){var i=k[e];s.defaults(n||(n={}),{emulateHTTP:r.emulateHTTP,emulateJSON:r.emulateJSON});var o={type:i,dataType:"json"};if(n.url||(o.url=s.result(t,"url")||D()),null!=n.data||!t||"create"!==e&&"update"!==e&&"patch"!==e||(o.contentType="application/json",o.data=JSON.stringify(n.attrs||t.toJSON(n))),n.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{}),n.emulateHTTP&&("PUT"===i||"DELETE"===i||"PATCH"===i)){o.type="POST",n.emulateJSON&&(o.data._method=i);var a=n.beforeSend;n.beforeSend=function(e){return e.setRequestHeader("X-HTTP-Method-Override",i),a?a.apply(this,arguments):void 0}}"GET"===o.type||n.emulateJSON||(o.processData=!1),"PATCH"===o.type&&w&&(o.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var l=n.xhr=r.ajax(s.extend(o,n));return t.trigger("request",t,l,n),l};var w=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),k={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};r.ajax=function(){return r.$.ajax.apply(r.$,arguments)};var M=r.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},C=/\((.*?)\)/g,R=/(\(\?)?:\w+/g,x=/\*\w+/g,F=/[\-{}\[\]+?.,\\\^$|#\s]/g;s.extend(M.prototype,o,{initialize:function(){},route:function(e,t,n){s.isRegExp(e)||(e=this._routeToRegExp(e)),s.isFunction(t)&&(n=t,t=""),n||(n=this[t]);var i=this;return r.history.route(e,function(s){var o=i._extractParameters(e,s);n&&n.apply(i,o),i.trigger.apply(i,["route:"+t].concat(o)),i.trigger("route",t,o),r.history.trigger("route",i,t,o)}),this},navigate:function(e,t){return r.history.navigate(e,t),this},_bindRoutes:function(){if(this.routes){this.routes=s.result(this,"routes");for(var e,t=s.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(F,"\\$&").replace(C,"(?:$1)?").replace(R,function(e,t){return t?e:"([^/]+)"}).replace(x,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){var n=e.exec(t).slice(1);return s.map(n,function(e){return e?decodeURIComponent(e):null})}});var A=r.History=function(){this.handlers=[],s.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},T=/^[#\/]|\s+$/g,S=/^\/+|\/+$/g,O=/msie [\w.]+/,I=/\/$/,E=/[?#].*$/;A.started=!1,s.extend(A.prototype,o,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(null==e)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.root.replace(I,"");e.indexOf(n)||(e=e.slice(n.length))}else e=this.getHash();return e.replace(T,"")},start:function(e){if(A.started)throw new Error("Backbone.history has already been started");A.started=!0,this.options=s.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var t=this.getFragment(),n=document.documentMode,i=O.exec(navigator.userAgent.toLowerCase())&&(!n||7>=n);this.root=("/"+this.root+"/").replace(S,"/"),i&&this._wantsHashChange&&(this.iframe=r.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?r.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!i?r.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t;var o=this.location,a=o.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!a)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._hasPushState&&a&&o.hash&&(this.fragment=this.getHash().replace(T,""),this.history.replaceState({},document.title,this.root+this.fragment+o.search))}return this.options.silent?void 0:this.loadUrl()},stop:function(){r.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),A.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(){var e=this.getFragment();return e===this.fragment&&this.iframe&&(e=this.getFragment(this.getHash(this.iframe))),e===this.fragment?!1:(this.iframe&&this.navigate(e),this.loadUrl(),void 0)},loadUrl:function(e){return e=this.fragment=this.getFragment(e),s.any(this.handlers,function(t){return t.route.test(e)?(t.callback(e),!0):void 0})},navigate:function(e,t){if(!A.started)return!1;t&&t!==!0||(t={trigger:!!t});var n=this.root+(e=this.getFragment(e||""));if(e=e.replace(E,""),this.fragment!==e){if(this.fragment=e,""===e&&"/"!==n&&(n=n.slice(0,-1)),this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,n){if(n){var i=e.href.replace(/(javascript:|#).*$/,"");e.replace(i+"#"+t)}else e.hash="#"+t}}),r.history=new A;var $=function(e,t){var n,i=this;n=e&&s.has(e,"constructor")?e.constructor:function(){return i.apply(this,arguments)},s.extend(n,i,t);var r=function(){this.constructor=n};return r.prototype=i.prototype,n.prototype=new r,e&&s.extend(n.prototype,e),n.__super__=i.prototype,n
};d.extend=f.extend=M.extend=y.extend=A.extend=$;var D=function(){throw new Error('A "url" property or function must be specified')},j=function(e,t){var n=t.error;t.error=function(i){n&&n(e,i,t),e.trigger("error",e,i,t)}}}.call(this),define("backbone",["underscore"],function(e){return function(){var t;return t||e.Backbone}}(this)),function(e,t,n){"object"==typeof exports?module.exports=t(require("underscore"),require("Backbone")):"function"==typeof define&&define.amd?define("mutators",["underscore","backbone"],function(i,r){return i=i===n?e._:i,r=r===n?e.Backbone:r,e.returnExportsGlobal=t(i,r,e)}):e.returnExportsGlobal=t(e._,e.Backbone)}(this,function(e,t,n,i){t=t===i?n.Backbone:t,e=e===i?n._:e;var r=function(){},s=t.Model.prototype.get,o=t.Model.prototype.set,a=t.Model.prototype.toJSON;return r.prototype.mutators={},r.prototype.get=function(t){var n=this.mutators!==i;return n===!0&&e.isFunction(this.mutators[t])===!0?this.mutators[t].call(this):n===!0&&e.isObject(this.mutators[t])===!0&&e.isFunction(this.mutators[t].get)===!0?this.mutators[t].get.call(this):s.call(this,t)},r.prototype.set=function(t,n,r){var s=this.mutators!==i,a=null,l=null;return e.isObject(t)||null===t?(l=t,r=n):(l={},l[t]=n),s===!0&&e.isObject(this.mutators[t])===!0&&(e.isFunction(this.mutators[t].set)===!0?a=this.mutators[t].set.call(this,t,l[t],r,e.bind(o,this)):e.isFunction(this.mutators[t])&&(a=this.mutators[t].call(this,t,l[t],r,e.bind(o,this)))),e.isObject(l)&&e.each(l,e.bind(function(t,n){var l=null;if(s===!0&&e.isObject(this.mutators[n])===!0){var u=this.mutators[n];e.isFunction(u.set)&&(u=u.set),e.isFunction(u)&&((r===i||e.isObject(r)===!0&&r.silent!==!0&&r.mutators!==i&&r.mutators.silent!==!0)&&this.trigger("mutators:set:"+n),l=u.call(this,n,t,r,e.bind(o,this)))}null===l&&(l=e.bind(o,this)(n,t,r)),a!==!1&&(a=l)},this)),null!==a?a:o.call(this,t,n,r)},r.prototype.toJSON=function(){var t=a.call(this);return e.each(this.mutators,e.bind(function(n,i){t[i]=e.isObject(this.mutators[i])===!0&&e.isFunction(this.mutators[i].get)?e.bind(this.mutators[i].get,this)():e.bind(this.mutators[i],this)()},this)),t},r.prototype.escape=function(t){var n=this.get(t);return e.escape(null==n?"":""+n)},e.extend(t.Model.prototype,r.prototype),t.Mutators=r,r}),!function(e){var t,n,i;"undefined"==typeof window?(t=require("underscore"),n=require("backbone"),i=n,"undefined"==typeof module||(module.exports=i)):(t=window._,n=window.Backbone,i=window),n.Relational={showWarnings:!0},n.Semaphore={_permitsAvailable:null,_permitsUsed:0,acquire:function(){if(this._permitsAvailable&&this._permitsUsed>=this._permitsAvailable)throw new Error("Max permits acquired");this._permitsUsed++},release:function(){if(0===this._permitsUsed)throw new Error("All permits released");this._permitsUsed--},isLocked:function(){return this._permitsUsed>0},setAvailablePermits:function(e){if(this._permitsUsed>e)throw new Error("Available permits cannot be less than used permits");this._permitsAvailable=e}},n.BlockingQueue=function(){this._queue=[]},t.extend(n.BlockingQueue.prototype,n.Semaphore,{_queue:null,add:function(e){this.isBlocked()?this._queue.push(e):e()},process:function(){var e=this._queue;for(this._queue=[];e&&e.length;)e.shift()()},block:function(){this.acquire()},unblock:function(){this.release(),this.isBlocked()||this.process()},isBlocked:function(){return this.isLocked()}}),n.Relational.eventQueue=new n.BlockingQueue,n.Store=function(){this._collections=[],this._reverseRelations=[],this._orphanRelations=[],this._subModels=[],this._modelScopes=[i]},t.extend(n.Store.prototype,n.Events,{initializeRelation:function(e,i,r){var s=t.isString(i.type)?n[i.type]||this.getObjectByName(i.type):i.type;s&&s.prototype instanceof n.Relation?new s(e,i,r):n.Relational.showWarnings&&"undefined"!=typeof console&&console.warn("Relation=%o; missing or invalid relation type!",i)},addModelScope:function(e){this._modelScopes.push(e)},removeModelScope:function(e){this._modelScopes=t.without(this._modelScopes,e)},addSubModels:function(e,t){this._subModels.push({superModelType:t,subModels:e})},setupSuperModel:function(e){t.find(this._subModels,function(n){return t.find(n.subModels||[],function(t,i){var r=this.getObjectByName(t);return e===r?(n.superModelType._subModels[i]=e,e._superModel=n.superModelType,e._subModelTypeValue=i,e._subModelTypeAttribute=n.superModelType.prototype.subModelTypeAttribute,!0):void 0},this)},this)},addReverseRelation:function(e){var n=t.any(this._reverseRelations,function(n){return t.all(e||[],function(e,t){return e===n[t]})});!n&&e.model&&e.type&&(this._reverseRelations.push(e),this._addRelation(e.model,e),this.retroFitRelation(e))},addOrphanRelation:function(e){var n=t.any(this._orphanRelations,function(n){return t.all(e||[],function(e,t){return e===n[t]})});!n&&e.model&&e.type&&this._orphanRelations.push(e)},processOrphanRelations:function(){t.each(this._orphanRelations.slice(0),function(e){var i=n.Relational.store.getObjectByName(e.relatedModel);i&&(this.initializeRelation(null,e),this._orphanRelations=t.without(this._orphanRelations,e))},this)},_addRelation:function(e,n){e.prototype.relations||(e.prototype.relations=[]),e.prototype.relations.push(n),t.each(e._subModels||[],function(e){this._addRelation(e,n)},this)},retroFitRelation:function(e){var t=this.getCollection(e.model,!1);t&&t.each(function(t){t instanceof e.model&&new e.type(t,e)},this)},getCollection:function(e,i){e instanceof n.RelationalModel&&(e=e.constructor);for(var r=e;r._superModel;)r=r._superModel;var s=t.find(this._collections,function(e){return e.model===r});return s||i===!1||(s=this._createCollection(r)),s},getObjectByName:function(n){var i=n.split("."),r=null;return t.find(this._modelScopes,function(n){return r=t.reduce(i||[],function(t,n){return t?t[n]:e},n),r&&r!==n?!0:void 0},this),r},_createCollection:function(e){var t;return e instanceof n.RelationalModel&&(e=e.constructor),e.prototype instanceof n.RelationalModel&&(t=new n.Collection,t.model=e,this._collections.push(t)),t},resolveIdForItem:function(e,i){var r=t.isString(i)||t.isNumber(i)?i:null;return null===r&&(i instanceof n.RelationalModel?r=i.id:t.isObject(i)&&(r=i[e.prototype.idAttribute])),r||0===r||(r=null),r},find:function(e,t){var n=this.resolveIdForItem(e,t),i=this.getCollection(e);if(i){var r=i.get(n);if(r instanceof e)return r}return null},register:function(e){var t=this.getCollection(e);if(t){var n=e.collection;t.add(e),this.listenTo(e,"destroy",this.unregister,this),this.listenTo(e,"relational:unregister",this.unregister,this),e.collection=n}},checkId:function(e,t){var i=this.getCollection(e),r=i&&i.get(t);if(r&&e!==r)throw n.Relational.showWarnings&&"undefined"!=typeof console&&console.warn("Duplicate id! Old RelationalModel=%o, new RelationalModel=%o",r,e),new Error("Cannot instantiate more than one Backbone.RelationalModel with the same id per type!")},update:function(e){var t=this.getCollection(e);t._onModelEvent("change:"+e.idAttribute,e,t),e.trigger("relational:change:id",e,t)},unregister:function(e,t,n){this.stopListening(e);var i=this.getCollection(e);i&&i.remove(e,n)},reset:function(){this.stopListening(),this._collections=[],this._subModels=[],this._modelScopes=[i]}}),n.Relational.store=new n.Store,n.Relation=function(e,i,r){if(this.instance=e,i=t.isObject(i)?i:{},this.reverseRelation=t.defaults(i.reverseRelation||{},this.options.reverseRelation),this.options=t.defaults(i,this.options,n.Relation.prototype.options),this.reverseRelation.type=t.isString(this.reverseRelation.type)?n[this.reverseRelation.type]||n.Relational.store.getObjectByName(this.reverseRelation.type):this.reverseRelation.type,this.key=this.options.key,this.keySource=this.options.keySource||this.key,this.keyDestination=this.options.keyDestination||this.keySource||this.key,this.model=this.options.model||this.instance.constructor,this.relatedModel=this.options.relatedModel,!t.isFunction(this.relatedModel)||this.relatedModel.prototype instanceof n.RelationalModel||(this.relatedModel=t.result(this,"relatedModel")),t.isString(this.relatedModel)&&(this.relatedModel=n.Relational.store.getObjectByName(this.relatedModel)),this.checkPreconditions()&&(!this.options.isAutoRelation&&this.reverseRelation.type&&this.reverseRelation.key&&n.Relational.store.addReverseRelation(t.defaults({isAutoRelation:!0,model:this.relatedModel,relatedModel:this.model,reverseRelation:this.options},this.reverseRelation)),e)){var s=this.keySource;s!==this.key&&"object"==typeof this.instance.get(this.key)&&(s=this.key),this.setKeyContents(this.instance.get(s)),this.relatedCollection=n.Relational.store.getCollection(this.relatedModel),this.keySource!==this.key&&delete this.instance.attributes[this.keySource],this.instance._relations[this.key]=this,this.initialize(r),this.options.autoFetch&&this.instance.fetchRelated(this.key,t.isObject(this.options.autoFetch)?this.options.autoFetch:{}),this.listenTo(this.instance,"destroy",this.destroy).listenTo(this.relatedCollection,"relational:add relational:change:id",this.tryAddRelated).listenTo(this.relatedCollection,"relational:remove",this.removeRelated)}},n.Relation.extend=n.Model.extend,t.extend(n.Relation.prototype,n.Events,n.Semaphore,{options:{createModels:!0,includeInJSON:!0,isAutoRelation:!1,autoFetch:!1,parse:!1},instance:null,key:null,keyContents:null,relatedModel:null,relatedCollection:null,reverseRelation:null,related:null,checkPreconditions:function(){var e=this.instance,i=this.key,r=this.model,s=this.relatedModel,o=n.Relational.showWarnings&&"undefined"!=typeof console;if(!r||!i||!s)return o&&console.warn("Relation=%o: missing model, key or relatedModel (%o, %o, %o).",this,r,i,s),!1;if(!(r.prototype instanceof n.RelationalModel))return o&&console.warn("Relation=%o: model does not inherit from Backbone.RelationalModel (%o).",this,e),!1;if(!(s.prototype instanceof n.RelationalModel))return o&&console.warn("Relation=%o: relatedModel does not inherit from Backbone.RelationalModel (%o).",this,s),!1;if(this instanceof n.HasMany&&this.reverseRelation.type===n.HasMany)return o&&console.warn("Relation=%o: relation is a HasMany, and the reverseRelation is HasMany as well.",this),!1;if(e&&t.keys(e._relations).length){var a=t.find(e._relations,function(e){return e.key===i},this);if(a)return o&&console.warn("Cannot create relation=%o on %o for model=%o: already taken by relation=%o.",this,i,e,a),!1}return!0},setRelated:function(e){this.related=e,this.instance.acquire(),this.instance.attributes[this.key]=e,this.instance.release()},_isReverseRelation:function(e){return e.instance instanceof this.relatedModel&&this.reverseRelation.key===e.key&&this.key===e.reverseRelation.key},getReverseRelations:function(e){var n=[],i=t.isUndefined(e)?this.related&&(this.related.models||[this.related]):[e];return t.each(i||[],function(e){t.each(e.getRelations()||[],function(e){this._isReverseRelation(e)&&n.push(e)},this)},this),n},destroy:function(){this.stopListening(),this instanceof n.HasOne?this.setRelated(null):this instanceof n.HasMany&&this.setRelated(this._prepareCollection()),t.each(this.getReverseRelations(),function(e){e.removeRelated(this.instance)},this)}}),n.HasOne=n.Relation.extend({options:{reverseRelation:{type:"HasMany"}},initialize:function(e){this.listenTo(this.instance,"relational:change:"+this.key,this.onChange);var n=this.findRelated(e);this.setRelated(n),t.each(this.getReverseRelations(),function(t){t.addRelated(this.instance,e)},this)},findRelated:function(e){var n=null;if(e=t.defaults({parse:this.options.parse},e),this.keyContents instanceof this.relatedModel)n=this.keyContents;else if(this.keyContents||0===this.keyContents){var i=t.defaults({create:this.options.createModels},e);n=this.relatedModel.findOrCreate(this.keyContents,i)}return this.related&&(this.keyId=null),n},setKeyContents:function(e){this.keyContents=e,this.keyId=n.Relational.store.resolveIdForItem(this.relatedModel,this.keyContents)},onChange:function(e,i,r){if(!this.isLocked()){this.acquire(),r=r?t.clone(r):{};var s=t.isUndefined(r.__related),o=s?this.related:r.__related;if(s){this.setKeyContents(i);var a=this.findRelated(r);this.setRelated(a)}if(o&&this.related!==o&&t.each(this.getReverseRelations(o),function(e){e.removeRelated(this.instance,null,r)},this),t.each(this.getReverseRelations(),function(e){e.addRelated(this.instance,r)},this),!r.silent&&this.related!==o){var l=this;this.changed=!0,n.Relational.eventQueue.add(function(){l.instance.trigger("change:"+l.key,l.instance,l.related,r,!0),l.changed=!1})}this.release()}},tryAddRelated:function(e,t,n){!this.keyId&&0!==this.keyId||e.id!==this.keyId||(this.addRelated(e,n),this.keyId=null)},addRelated:function(e,n){var i=this;e.queue(function(){if(e!==i.related){var r=i.related||null;i.setRelated(e),i.onChange(i.instance,e,t.defaults({__related:r},n))}})},removeRelated:function(e,n,i){if(this.related&&e===this.related){var r=this.related||null;this.setRelated(null),this.onChange(this.instance,e,t.defaults({__related:r},i))}}}),n.HasMany=n.Relation.extend({collectionType:null,options:{reverseRelation:{type:"HasOne"},collectionType:n.Collection,collectionKey:!0,collectionOptions:{}},initialize:function(e){if(this.listenTo(this.instance,"relational:change:"+this.key,this.onChange),this.collectionType=this.options.collectionType,!t.isFunction(this.collectionType)||this.collectionType===n.Collection||this.collectionType.prototype instanceof n.Collection||(this.collectionType=t.result(this,"collectionType")),t.isString(this.collectionType)&&(this.collectionType=n.Relational.store.getObjectByName(this.collectionType)),this.collectionType!==n.Collection&&!(this.collectionType.prototype instanceof n.Collection))throw new Error("`collectionType` must inherit from Backbone.Collection");var i=this.findRelated(e);this.setRelated(i)},_prepareCollection:function(e){if(this.related&&this.stopListening(this.related),!(e&&e instanceof n.Collection)){var i=t.isFunction(this.options.collectionOptions)?this.options.collectionOptions(this.instance):this.options.collectionOptions;e=new this.collectionType(null,i)}if(e.model=this.relatedModel,this.options.collectionKey){var r=this.options.collectionKey===!0?this.options.reverseRelation.key:this.options.collectionKey;e[r]&&e[r]!==this.instance?n.Relational.showWarnings&&"undefined"!=typeof console&&console.warn("Relation=%o; collectionKey=%s already exists on collection=%o",this,r,this.options.collectionKey):r&&(e[r]=this.instance)}return this.listenTo(e,"relational:add",this.handleAddition).listenTo(e,"relational:remove",this.handleRemoval).listenTo(e,"relational:reset",this.handleReset),e},findRelated:function(e){var i=null;if(e=t.defaults({parse:this.options.parse},e),this.keyContents instanceof n.Collection)this._prepareCollection(this.keyContents),i=this.keyContents;else{var r=[];t.each(this.keyContents,function(n){if(n instanceof this.relatedModel)var i=n;else i=this.relatedModel.findOrCreate(n,t.extend({merge:!0},e,{create:this.options.createModels}));i&&r.push(i)},this),i=this.related instanceof n.Collection?this.related:this._prepareCollection(),i.set(r,t.defaults({merge:!1,parse:!1},e))}return this.keyIds=t.difference(this.keyIds,t.pluck(i.models,"id")),i},setKeyContents:function(e){this.keyContents=e instanceof n.Collection?e:null,this.keyIds=[],this.keyContents||!e&&0!==e||(this.keyContents=t.isArray(e)?e:[e],t.each(this.keyContents,function(e){var t=n.Relational.store.resolveIdForItem(this.relatedModel,e);(t||0===t)&&this.keyIds.push(t)},this))},onChange:function(e,i,r){r=r?t.clone(r):{},this.setKeyContents(i),this.changed=!1;var s=this.findRelated(r);if(this.setRelated(s),!r.silent){var o=this;n.Relational.eventQueue.add(function(){o.changed&&(o.instance.trigger("change:"+o.key,o.instance,o.related,r,!0),o.changed=!1)})}},handleAddition:function(e,i,r){r=r?t.clone(r):{},this.changed=!0,t.each(this.getReverseRelations(e),function(e){e.addRelated(this.instance,r)},this);var s=this;!r.silent&&n.Relational.eventQueue.add(function(){s.instance.trigger("add:"+s.key,e,s.related,r)})},handleRemoval:function(e,i,r){r=r?t.clone(r):{},this.changed=!0,t.each(this.getReverseRelations(e),function(e){e.removeRelated(this.instance,null,r)},this);var s=this;!r.silent&&n.Relational.eventQueue.add(function(){s.instance.trigger("remove:"+s.key,e,s.related,r)})},handleReset:function(e,i){var r=this;i=i?t.clone(i):{},!i.silent&&n.Relational.eventQueue.add(function(){r.instance.trigger("reset:"+r.key,r.related,i)})},tryAddRelated:function(e,n,i){var r=t.contains(this.keyIds,e.id);r&&(this.addRelated(e,i),this.keyIds=t.without(this.keyIds,e.id))},addRelated:function(e,n){var i=this;e.queue(function(){i.related&&!i.related.get(e)&&i.related.add(e,t.defaults({parse:!1},n))})},removeRelated:function(e,t,n){this.related.get(e)&&this.related.remove(e,n)}}),n.RelationalModel=n.Model.extend({relations:null,_relations:null,_isInitialized:!1,_deferProcessing:!1,_queue:null,_attributeChangeFired:!1,subModelTypeAttribute:"type",subModelTypes:null,constructor:function(e,i){if(i&&i.collection){var r=this,s=this.collection=i.collection;delete i.collection,this._deferProcessing=!0;var o=function(e){e===r&&(r._deferProcessing=!1,r.processQueue(),s.off("relational:add",o))};s.on("relational:add",o),t.defer(function(){o(r)})}n.Relational.store.processOrphanRelations(),this._queue=new n.BlockingQueue,this._queue.block(),n.Relational.eventQueue.block();try{n.Model.apply(this,arguments)}finally{n.Relational.eventQueue.unblock()}},trigger:function(e){if(e.length>5&&0===e.indexOf("change")){var t=this,i=arguments;n.Relational.eventQueue.add(function(){if(t._isInitialized){var r=!0;if("change"===e)r=t.hasChanged()||t._attributeChangeFired,t._attributeChangeFired=!1;else{var s=e.slice(7),o=t.getRelation(s);o?(r=i[4]===!0,r?t.changed[s]=i[2]:o.changed||delete t.changed[s]):r&&(t._attributeChangeFired=!0)}r&&n.Model.prototype.trigger.apply(t,i)}})}else n.Model.prototype.trigger.apply(this,arguments);return this},initializeRelations:function(e){this.acquire(),this._relations={},t.each(t.result(this,"relations")||[],function(t){n.Relational.store.initializeRelation(this,t,e)},this),this._isInitialized=!0,this.release(),this.processQueue()},updateRelations:function(e){this._isInitialized&&!this.isLocked()&&t.each(this._relations,function(t){var n=this.attributes[t.keySource]||this.attributes[t.key];t.related!==n&&this.trigger("relational:change:"+t.key,this,n,e||{}),t.keySource!==t.key&&delete t.instance.attributes[t.keySource]},this)},queue:function(e){this._queue.add(e)},processQueue:function(){this._isInitialized&&!this._deferProcessing&&this._queue.isBlocked()&&this._queue.unblock()},getRelation:function(e){return this._relations[e]},getRelations:function(){return t.values(this._relations)},fetchRelated:function(e,i,r){i=t.extend({update:!0,remove:!1},i);var s,o=[],a=this.getRelation(e),l=a&&(a.keyIds&&a.keyIds.slice(0)||(a.keyId||0===a.keyId?[a.keyId]:[]));if(r){var u=a.related instanceof n.Collection?a.related.models:[a.related];t.each(u,function(e){(e.id||0===e.id)&&l.push(e.id)})}if(l&&l.length){var c=[],u=t.map(l,function(e){var t=n.Relational.store.find(a.relatedModel,e);if(!t){var r={};r[a.relatedModel.prototype.idAttribute]=e,t=a.relatedModel.findOrCreate(r,i),c.push(t)}return t},this);if(a.related instanceof n.Collection&&t.isFunction(a.related.url)&&(s=a.related.url(u)),s&&s!==a.related.url()){var d=t.defaults({error:function(){var e=arguments;t.each(c,function(t){t.trigger("destroy",t,t.collection,i),i.error&&i.error.apply(t,e)})},url:s},i);o=[a.related.fetch(d)]}else o=t.map(u,function(e){var n=t.defaults({error:function(){t.contains(c,e)&&(e.trigger("destroy",e,e.collection,i),i.error&&i.error.apply(e,arguments))}},i);return e.fetch(n)},this)}return o},get:function(i){var r=n.Model.prototype.get.call(this,i);if(!this.dotNotation||-1===i.indexOf("."))return r;var s=i.split("."),o=t.reduce(s,function(i,r){if(t.isNull(i)||t.isUndefined(i))return e;if(i instanceof n.Model)return n.Model.prototype.get.call(i,r);if(i instanceof n.Collection)return n.Collection.prototype.at.call(i,r);throw new Error("Attribute must be an instanceof Backbone.Model or Backbone.Collection. Is: "+i+", currentSplit: "+r)},this);if(r!==e&&o!==e)throw new Error("Ambiguous result for '"+i+"'. direct result: "+r+", dotNotation: "+o);return r||o},set:function(e,i,r){n.Relational.eventQueue.block();var s;t.isObject(e)||null==e?(s=e,r=i):(s={},s[e]=i);try{var o=this.id,a=s&&this.idAttribute in s&&s[this.idAttribute];n.Relational.store.checkId(this,a);var l=n.Model.prototype.set.apply(this,arguments);this._isInitialized||this.isLocked()?a&&a!==o&&n.Relational.store.update(this):(this.constructor.initializeModelHierarchy(),n.Relational.store.register(this),this.initializeRelations(r)),s&&this.updateRelations(r)}finally{n.Relational.eventQueue.unblock()}return l},clone:function(){var e=t.clone(this.attributes);return t.isUndefined(e[this.idAttribute])||(e[this.idAttribute]=null),t.each(this.getRelations(),function(t){delete e[t.key]}),new this.constructor(e)},toJSON:function(e){if(this.isLocked())return this.id;this.acquire();var i=n.Model.prototype.toJSON.call(this,e);return!this.constructor._superModel||this.constructor._subModelTypeAttribute in i||(i[this.constructor._subModelTypeAttribute]=this.constructor._subModelTypeValue),t.each(this._relations,function(r){var s=i[r.key],o=r.options.includeInJSON,a=null;o===!0?s&&t.isFunction(s.toJSON)&&(a=s.toJSON(e)):t.isString(o)?(s instanceof n.Collection?a=s.pluck(o):s instanceof n.Model&&(a=s.get(o)),o===r.relatedModel.prototype.idAttribute&&(r instanceof n.HasMany?a=a.concat(r.keyIds):r instanceof n.HasOne&&(a=a||r.keyId))):t.isArray(o)?s instanceof n.Collection?(a=[],s.each(function(e){var n={};t.each(o,function(t){n[t]=e.get(t)}),a.push(n)})):s instanceof n.Model&&(a={},t.each(o,function(e){a[e]=s.get(e)})):delete i[r.key],o&&(i[r.keyDestination]=a),r.keyDestination!==r.key&&delete i[r.key]}),this.release(),i}},{setup:function(){return this.prototype.relations=(this.prototype.relations||[]).slice(0),this._subModels={},this._superModel=null,this.prototype.hasOwnProperty("subModelTypes")?n.Relational.store.addSubModels(this.prototype.subModelTypes,this):this.prototype.subModelTypes=null,t.each(this.prototype.relations||[],function(e){if(e.model||(e.model=this),e.reverseRelation&&e.model===this){var i=!0;if(t.isString(e.relatedModel)){var r=n.Relational.store.getObjectByName(e.relatedModel);i=r&&r.prototype instanceof n.RelationalModel}i?n.Relational.store.initializeRelation(null,e):t.isString(e.relatedModel)&&n.Relational.store.addOrphanRelation(e)}},this),this},build:function(e,t){this.initializeModelHierarchy();var n=this._findSubModelType(this,e)||this;return new n(e,t)},_findSubModelType:function(e,t){if(e._subModels&&e.prototype.subModelTypeAttribute in t){var n=t[e.prototype.subModelTypeAttribute],i=e._subModels[n];if(i)return i;for(n in e._subModels)if(i=this._findSubModelType(e._subModels[n],t))return i}return null},initializeModelHierarchy:function(){if(this.inheritRelations(),this.prototype.subModelTypes){var e=t.keys(this._subModels),i=t.omit(this.prototype.subModelTypes,e);t.each(i,function(e){var t=n.Relational.store.getObjectByName(e);t&&t.initializeModelHierarchy()})}},inheritRelations:function(){if(t.isUndefined(this._superModel)||t.isNull(this._superModel))if(n.Relational.store.setupSuperModel(this),this._superModel){if(this._superModel.inheritRelations(),this._superModel.prototype.relations){var e=t.select(this._superModel.prototype.relations||[],function(e){return!t.any(this.prototype.relations||[],function(t){return e.relatedModel===t.relatedModel&&e.key===t.key},this)},this);this.prototype.relations=e.concat(this.prototype.relations)}}else this._superModel=!1},findOrCreate:function(e,i){i||(i={});var r=t.isObject(e)&&i.parse&&this.prototype.parse?this.prototype.parse(t.clone(e)):e,s=n.Relational.store.find(this,r);return t.isObject(e)&&(s&&i.merge!==!1?(delete i.collection,delete i.url,s.set(r,i)):s||i.create===!1||(s=this.build(e,i))),s},find:function(e,t){return t||(t={}),t.create=!1,this.findOrCreate(e,t)}}),t.extend(n.RelationalModel.prototype,n.Semaphore),n.Collection.prototype.__prepareModel=n.Collection.prototype._prepareModel,n.Collection.prototype._prepareModel=function(e,t){var i;return e instanceof n.Model?(e.collection||(e.collection=this),i=e):(t||(t={}),t.collection=this,i="undefined"!=typeof this.model.findOrCreate?this.model.findOrCreate(e,t):new this.model(e,t),i&&i.isNew()&&!i._validate(e,t)&&(this.trigger("invalid",this,e,t),i=!1)),i};var r=n.Collection.prototype.__set=n.Collection.prototype.set;n.Collection.prototype.set=function(e,i){if(!(this.model.prototype instanceof n.RelationalModel))return r.apply(this,arguments);i&&i.parse&&(e=this.parse(e,i)),t.isArray(e)||(e=e?[e]:[]);var s=[],o=[];return t.each(e,function(e){e instanceof n.Model||(e=n.Collection.prototype._prepareModel.call(this,e,i)),e&&(o.push(e),this.get(e)||this.get(e.cid)?null!=e.id&&(this._byId[e.id]=e):s.push(e))},this),r.call(this,o,t.defaults({parse:!1},i)),t.each(s,function(e){(this.get(e)||this.get(e.cid))&&this.trigger("relational:add",e,this,i)},this),this};var s=n.Collection.prototype.__remove=n.Collection.prototype.remove;n.Collection.prototype.remove=function(e,i){if(!(this.model.prototype instanceof n.RelationalModel))return s.apply(this,arguments);e=t.isArray(e)?e.slice(0):[e],i||(i={});var r=[];return t.each(e,function(e){e=this.get(e)||e&&this.get(e.cid),e&&r.push(e)},this),r.length&&(s.call(this,r,i),t.each(r,function(e){this.trigger("relational:remove",e,this,i)},this)),this};var o=n.Collection.prototype.__reset=n.Collection.prototype.reset;n.Collection.prototype.reset=function(e,i){return i=t.extend({merge:!0},i),o.call(this,e,i),this.model.prototype instanceof n.RelationalModel&&this.trigger("relational:reset",this,i),this};var a=n.Collection.prototype.__sort=n.Collection.prototype.sort;n.Collection.prototype.sort=function(e){return a.call(this,e),this.model.prototype instanceof n.RelationalModel&&this.trigger("relational:reset",this,e),this};var l=n.Collection.prototype.__trigger=n.Collection.prototype.trigger;n.Collection.prototype.trigger=function(e){if(!(this.model.prototype instanceof n.RelationalModel))return l.apply(this,arguments);if("add"===e||"remove"===e||"reset"===e||"sort"===e){var i=this,r=arguments;t.isObject(r[3])&&(r=t.toArray(r),r[3]=t.clone(r[3])),n.Relational.eventQueue.add(function(){l.apply(i,r)})}else l.apply(this,arguments);return this},n.RelationalModel.extend=function(){var e=n.Model.extend.apply(this,arguments);return e.setup(this),e}}(),define("relational",["backbone"],function(){}),define("consumer/models/consumer/address",["underscore","backbone","mutators","relational"],function(e,t){return t.RelationalModel.extend({urlRoot:getApiUrlForPath("/consumer/me/address/","v2"),getGoogleLatLng:function(){return new google.maps.LatLng(this.get("lat"),this.get("lng"))},url:function(){var e=t.Model.prototype.url.call(this);return e+("/"==e.charAt(e.length-1)?"":"/")}})}),define("text",["module"],function(e){var t,n,i,r,s=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],o=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,a=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,l="undefined"!=typeof location&&location.href,u=l&&location.protocol&&location.protocol.replace(/\:/,""),c=l&&location.hostname,d=l&&(location.port||void 0),h={},f=e.config&&e.config()||{};return t={version:"2.0.7",strip:function(e){if(e){e=e.replace(o,"");var t=e.match(a);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:f.createXhr||function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t+=1){n=s[t];try{e=new ActiveXObject(n)}catch(i){}if(e){s=[n];break}}return e},parseName:function(e){var t,n,i,r=!1,s=e.indexOf("."),o=0===e.indexOf("./")||0===e.indexOf("../");return-1!==s&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,i=n||t,s=i.indexOf("!"),-1!==s&&(r="strip"===i.substring(s+1),i=i.substring(0,s),n?n=i:t=i),{moduleName:t,ext:n,strip:r}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,i,r){var s,o,a,l=t.xdRegExp.exec(e);return l?(s=l[2],o=l[3],o=o.split(":"),a=o[1],o=o[0],!(s&&s!==n||o&&o.toLowerCase()!==i.toLowerCase()||(a||o)&&a!==r)):!0},finishLoad:function(e,n,i,r){i=n?t.strip(i):i,f.isBuild&&(h[e]=i),r(i)},load:function(e,n,i,r){if(r.isBuild&&!r.inlineText)return i(),void 0;f.isBuild=r.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),a=n.toUrl(o),h=f.useXhr||t.useXhr;!l||h(a,u,c,d)?t.get(a,function(n){t.finishLoad(e,s.strip,n,i)},function(e){i.error&&i.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,i)})},write:function(e,n,i){if(h.hasOwnProperty(n)){var r=t.jsEscape(h[n]);i.asModule(e+"!"+n,"define(function () { return '"+r+"';});\n")}},writeFile:function(e,n,i,r,s){var o=t.parseName(n),a=o.ext?"."+o.ext:"",l=o.moduleName+a,u=i.toUrl(o.moduleName+a)+".js";t.load(l,i,function(){var n=function(e){return r(u,e)};n.asModule=function(e,t){return r.asModule(e,u,t)},t.write(e,l,n,s)},s)}},"node"===f.env||!f.env&&"undefined"!=typeof process&&process.versions&&process.versions.node?(n=require.nodeRequire("fs"),t.get=function(e,t,i){try{var r=n.readFileSync(e,"utf8");0===r.indexOf("﻿")&&(r=r.substring(1)),t(r)}catch(s){i(s)}}):"xhr"===f.env||!f.env&&t.createXhr()?t.get=function(e,n,i,r){var s,o=t.createXhr();if(o.open("GET",e,!0),r)for(s in r)r.hasOwnProperty(s)&&o.setRequestHeader(s.toLowerCase(),r[s]);f.onXhr&&f.onXhr(o,e),o.onreadystatechange=function(){var t,r;4===o.readyState&&(t=o.status,t>399&&600>t?(r=new Error(e+" HTTP status: "+t),r.xhr=o,i(r)):n(o.responseText),f.onXhrComplete&&f.onXhrComplete(o,e))},o.send(null)}:"rhino"===f.env||!f.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var n,i,r="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),a=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),r)),l="";try{for(n=new java.lang.StringBuffer,i=a.readLine(),i&&i.length()&&65279===i.charAt(0)&&(i=i.substring(1)),null!==i&&n.append(i);null!==(i=a.readLine());)n.append(o),n.append(i);l=String(n.toString())}finally{a.close()}t(l)}:("xpconnect"===f.env||!f.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(i=Components.classes,r=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),t.get=function(e,t){var n,s,o={},a=new FileUtils.File(e);try{n=i["@mozilla.org/network/file-input-stream;1"].createInstance(r.nsIFileInputStream),n.init(a,1,0,!1),s=i["@mozilla.org/intl/converter-input-stream;1"].createInstance(r.nsIConverterInputStream),s.init(n,"utf-8",n.available(),r.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),s.readString(n.available(),o),s.close(),n.close(),t(o.value)}catch(l){throw new Error((a&&a.path||"")+": "+l)}}),t}),define("text!consumer/templates/consumer/home-map-picker-info-window.html",[],function(){return'<div class="home-map-picker-info-window">\n  <% if (num_of_restaurants === 0) { %>\n    <p>There are no restaurants near your location.</p>\n    <p>We\'re working on expanding!</p>\n  <% } else if (num_of_restaurants > 0) { %>\n    <% if (num_of_restaurants == 1) { %>\n      <p>There is 1 restaurant near your location</p>\n    <% } else { %>\n      <p>There are <%-num_of_restaurants%> restaurants near your location</p>\n    <% } %>\n    <form action="/restaurant/" method="post">\n      <input type="hidden" name="csrfmiddlewaretoken" value="<%- csrf_token %>" />\n      <% if (address.lat && address.lng) { %>\n        <input type="hidden" name="lat" value=<%- address.lat %> />\n        <input type="hidden" name="lng" value=<%- address.lng %> />\n      <% } else { %>\n        <input type="hidden" name="printable_address" value="<%- address.printable_address %>" />\n      <% } %>\n\n      <input type="submit" class="btn btn-success" value="Show Restaurants" />\n    </form>\n  <% } else { %>\n    <center><img src="<%- STATIC_URL %>img/ajax-loader.gif" /></center>\n  <% } %>\n</div>'
}),define("consumer/views/consumer/home-map-picker",["underscore","backbone","consumer/models/consumer/address","text!consumer/templates/consumer/home-map-picker-info-window.html"],function(e,t,n,i){var r=t.View.extend({el:"#home-map-picker-container",MAP_ZOOM_DEFAULT:15,MAP_HEIGHT:490,events:{"click #home-address-search":"searchAddressViaClick","keyup #home-address-input":"typingAddress","mouseenter #home-address-location":"mouseenterCurrentLocationIcon","mouseleave #home-address-location":"mouseleaveCurrentLocationIcon","click #home-address-location":"clickCurrentLocationIcon"},initialize:function(){e.bindAll(this,"createAutocompleteAddressInput","createGoogleMaps","showAddress","searchAddress","searchAddressViaClick","searchAddressViaCoordinate","typingAddress","showInfoWindow","hideNoAddressFoundMessage","showNoAddressFoundMessage","mouseenterCurrentLocationIcon","mouseleaveCurrentLocationIcon","clickCurrentLocationIcon","getCurrentLocation","getCurrentLocationFail"),this.geocoder=new google.maps.Geocoder,this.model=new n},createAutocompleteAddressInput:function(){this.addressInput=new google.maps.places.Autocomplete(document.getElementById("home-address-input"),{types:["geocode"]});var e=this;google.maps.event.addListener(this.addressInput,"place_changed",function(){e.geolocating=!1;var t=e.addressInput.getPlace();t&&t.reference&&t.address_components.length>1?(e.model.set({printable_address:t.formatted_address,lat:null,lng:null}),e.showAddress(t.geometry.location)):e.searchAddress()}),$("#home-address-input").focus()},createGoogleMaps:function(e){this.map=new google.maps.Map(document.getElementById("home-map-canvas"),{mapTypeId:google.maps.MapTypeId.ROADMAP,streetViewControl:!1,overviewMapControl:!1,mapTypeControl:!1,zoom:this.MAP_ZOOM_DEFAULT,center:e}),this.marker=new google.maps.Marker({position:e,map:this.map,draggable:!0});var t=this;google.maps.event.addListener(this.marker,"dragend",function(){t.hideNoAddressFoundMessage();var e=t.marker.getPosition();t.usingCurrentLocation=!1,t.geolocating=!1,$("#home-address-location").removeClass("location-icon-active"),t.searchAddressViaCoordinate(e)}),this.showInfoWindow(),google.maps.event.addListener(this.map,"bounds_changed",function(){t.addressInput&&t.addressInput.setBounds(t.map.getBounds())})},searchAddress:function(){$("#home-address-search").addClass("searching"),$("#home-address-search").removeClass("search-icon"),$("#home-address-search").addClass("spinner");var e=this;this.geocoder.geocode({address:$("#home-address-input").val()},function(t,n){if($("#home-address-search").removeClass("searching"),$("#home-address-search").addClass("search-icon"),$("#home-address-search").removeClass("spinner"),n==google.maps.GeocoderStatus.OK){var i=t[0];if(i)return e.model.set({printable_address:i.formatted_address,lat:null,lng:null}),e.showAddress(i.geometry.location),void 0}e.showNoAddressFoundMessage()})},showAddress:function(e){if(this.map)this.marker.setPosition(e),this.model.get("lat")&&this.model.get("lng")&&!this.geolocating||(this.map.setCenter(e),this.map.setZoom(this.MAP_ZOOM_DEFAULT)),this.showInfoWindow();else{var t=this;$("#home-content").animate({"margin-top":0},"fast",function(){$("#home-map-canvas").css("height",t.MAP_HEIGHT),$("#home-map-canvas").css("position","static"),$("#home-map-canvas-legend").show(),$("#home-map-canvas-placeholder").remove(),t.createGoogleMaps(e)}),$("#home-map-canvas").css("z-index",0)}},showInfoWindow:function(){var t=e.template(i);if(this.infowindow)this.infowindow.setContent(t({address:this.model.toJSON(),num_of_restaurants:null,csrf_token:getCookie("csrf_token")}).trim());else{var t=e.template(i);this.infowindow=new google.maps.InfoWindow({content:t({address:this.model.toJSON(),num_of_restaurants:null,csrf_token:getCookie("csrf_token")}).trim(),maxWidth:300}),this.infowindow.open(this.map,this.marker),google.maps.event.addListener(this.marker,"click",function(){o.infowindow.open(o.map,o.marker)})}var n=this.marker.getPosition(),r={lat:n.lat(),lng:n.lng(),num_only:1,zip_code:this.model.get("zip_code")},s=$.ajax({url:"/api/v2/restaurant/",method:"GET",data:r,contentType:"application/json"}),o=this;s.done(function(e){o.infowindow.setContent(t({address:o.model.toJSON(),num_of_restaurants:e,csrf_token:getCookie("csrf_token")}).trim()),o.infowindow.open(o.map,o.marker)}),s.fail(function(){})},hideNoAddressFoundMessage:function(){this.noAddressFound&&($("#home-no-address-found").slideUp("fast"),this.noAddressFound=!1)},showNoAddressFoundMessage:function(){if(!this.noAddressFound&&($("#home-no-address-found").slideDown("fast"),this.noAddressFound=!0,this.infowindow)){var t=e.template(i);this.infowindow.setContent(t({address:null,num_of_restaurants:0,csrf_token:getCookie("csrf_token")}).trim())}},searchAddressViaClick:function(){this.searchAddress()},searchAddressViaCoordinate:function(e,t){$("#home-address-search").addClass("searching"),$("#home-address-search").removeClass("search-icon"),$("#home-address-search").addClass("spinner");var n=this;this.geocoder.geocode({latLng:e},function(i,r){if($("#home-address-search").removeClass("searching"),$("#home-address-search").addClass("search-icon"),$("#home-address-search").removeClass("spinner"),r==google.maps.GeocoderStatus.OK){var s=i[0];if(s)return n.model.set({lat:e.lat(),lng:e.lng(),printable_address:s.formatted_address}),n.showAddress(e),$("#home-address-input").val(n.model.get("printable_address")),t&&t(),void 0}n.showNoAddressFoundMessage()})},typingAddress:function(e){13!=e.keyCode&&(this.addressInput||this.createAutocompleteAddressInput(),this.usingCurrentLocation&&(this.usingCurrentLocation=!1,$("#home-address-location").removeClass("location-icon-active")),this.hideNoAddressFoundMessage(),this.geolocating&&($("#home-address-search").removeClass("searching"),$("#home-address-search").addClass("search-icon"),$("#home-address-search").removeClass("spinner"),this.geolocating=!1))},mouseenterCurrentLocationIcon:function(){this.usingCurrentLocation||($("#home-address-input").data("address-text-placeholder",$("#home-address-input").val()),$("#home-address-input").val("Use Current Location"))},mouseleaveCurrentLocationIcon:function(){this.usingCurrentLocation||$("#home-address-input").val($("#home-address-input").data("address-text-placeholder"))},clickCurrentLocationIcon:function(){navigator.geolocation?(this.geolocating=!0,$("#home-address-search").addClass("searching"),$("#home-address-search").removeClass("search-icon"),$("#home-address-search").addClass("spinner"),navigator.geolocation.getCurrentPosition(this.getCurrentLocation,this.getCurrentLocationFail)):alert("Your browser does not support geolocation. Please enter your address manually.")},getCurrentLocation:function(e){if(this.geolocating){var t=new google.maps.LatLng(e.coords.latitude,e.coords.longitude),n=this;this.searchAddressViaCoordinate(t,function(){n.usingCurrentLocation=!0,$("#home-address-location").addClass("location-icon-active"),n.geolocating=!1})}},getCurrentLocationFail:function(){this.geolocating&&($("#home-address-search").removeClass("searching"),$("#home-address-search").addClass("search-icon"),$("#home-address-search").removeClass("spinner"),alert("We couldn't detect your location. Please enter your address manually."),$("#home-address-input").focus(),this.geolocating=!1)}});return r}),define("consumer/home-app",["consumer/views/consumer/home-map-picker"],function(e){new e});